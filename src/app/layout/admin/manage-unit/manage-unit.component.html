<!--Main Navigation-->
<admin-header [Status]="status"></admin-header>
<!--Main Navigation-->

<!--Main layout-->
<main>
  <h5>Quản lý đơn vị sản phẩm</h5>
  <div class="container pt-4 main-layout">
    <div class="row">
      <div class="col-6">
        <button class="btn btn-outline-primary" (click)="openNew(0, 0)">Thêm mới đơn vị</button>
      </div>
      <div class="col-6">
        <div class="input-group mb-3 float-end">
          <form style="width: 100%" (ngSubmit)="onSearch()">
            <div class="input-group mb-3">
              <input type="text" name="phonenumber" class="form-control inputRoot" pInputText [(ngModel)]="nameSearch"
                     placeholder="Nhập tên đơn vị...">
              <button type="submit" class="buttonRoot" pButton pRipple icon="pi pi-search"></button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="mt-2">
      <div class="container-fluid">
        <p-table [value]="units.list">
          <ng-template pTemplate="header">
            <tr>
              <th class="col-1"></th>
              <th class="col-1">STT</th>
              <th class="col-1">Tên đơn vị</th>
              <th class="col-1">Số lượng</th>
              <th class="col-2">Ngày tạo</th>
              <th class="col-2">Thao tác</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rowIndex="rowIndex" let-unit let-expanded="expanded">
            <tr>
              <td>
                <a type="button"
                        pButton pRipple
                        [pRowToggler]="unit"
                        class="p-button-text p-button-rounded p-button-plain"
                        [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                        *ngIf="unit.list != null"
                        href="#collapse-{{unit.id}}"
                        data-bs-toggle="collapse">
                </a>
              </td>
              <td>{{rowIndex + 1}}</td>
              <td>{{unit.unitName}}</td>
              <td>{{unit.amount}}</td>
              <td>{{unit.createdDate | date: 'dd/MM/yyyy'}}</td>
              <td>
                <button class="buttonRoot me-1" (click)="openNew(unit.id, 0)">
                  <i class="pi pi-plus-circle"></i>
                </button>
                <button class="buttonRoot me-1" (click)="openUpdate(unit.id, 0)">
                  <i class="pi pi-pencil"></i>
                </button>
                <button class="buttonRoot-delte" (click)="deleteSelectUnit(unit.id, 0)">
                  <i class="pi pi-trash"></i>
                </button>
              </td>
            </tr>
            <tr class="collapse" id="collapse-{{unit.id}}" *ngFor="let item of unit.list; let i = index">
              <td></td>
              <td class="border-danger">{{i + 1}}</td>
              <td>{{item.unitName}}</td>
              <td>{{item.amount}}</td>
              <td>{{item.createdDate | date: 'dd/MM/yyyy'}}</td>
              <td>
                <button class="buttonRoot me-1" (click)="openUpdate(item.id, item.parent)">
                  <i class="pi pi-pencil"></i>
                </button>
                <button class="buttonRoot-delte" (click)="deleteSelectUnit(item.id, unit.id)">
                  <i class="pi pi-trash"></i>
                </button>
              </td>
            </tr>
          </ng-template>
        </p-table>
        <p-paginator [rows]="10" [totalRecords]="totalItems" [rowsPerPageOptions]="[10,25,50]"
                     (onPageChange)="paginate($event)"></p-paginator>
      </div>
    </div>
  </div>

  <p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
  <p-toast></p-toast>
  <admin-footer></admin-footer>
</main>
<!--Main layout-->

<p-dialog [(visible)]="unitDialog" [style]="{width: '550px'}" header="Thêm mới đơn vị" [modal]="true" styleClass="p-fluid" [draggable]="false">
  <ng-template pTemplate="content">
    <div class="mb-3">
      <label for="name" class="form-label">Tên đơn vị</label>
      <input type="text" class="form-control" id="name" [(ngModel)]="unit.unitName" required>
      <small class="text-danger" *ngIf="submitted && !unit.unitName">Tên đơn vị không được để trống.</small>
    </div>
    <div class="mb-3">
      <label for="description" class="form-label">Mô tả</label>
      <textarea class="form-control" id="description" rows="3" [(ngModel)]="unit.description"></textarea>
    </div>
    <div class="p-formgrid p-grid mb-3">
      <div class="p-field p-col">
        <label for="price">Số lượng</label>
        <p-inputNumber id="price" mode="decimal" [(ngModel)]="unit.amount" [min]="1"></p-inputNumber>
        <small class="p-invalid text-danger" *ngIf="submitted && !unit.amount">Số lượng không được để trống.</small>
      </div>
    </div>
    <div class="field mb-3" *ngIf="showCategory">
      <label class="mb-3">Danh mục</label>
      <div class="formgrid grid">
        <div class="field-radiobutton col-6">
          <p-radioButton id="locate1" name="locate" value="parent"
                         [(ngModel)]="selectedValueLocateUnit"></p-radioButton>
          <label for="locate1">Parent</label>
        </div>
        <div class="field-radiobutton col-6">
          <p-radioButton id="locate2" name="locate" value="child"
                         [(ngModel)]="selectedValueLocateUnit" check></p-radioButton>
          <label for="locate2">Child</label>
        </div>
      </div>
    </div>
<!--    <div class="row text-center mt-3">-->
<!--      <button class="root-btn" (click)="saveAndUpdateUnit()">Thêm mới</button>-->
<!--    </div>-->
  </ng-template>
  <ng-template pTemplate="footer">
    <button class="root-btn" (click)="saveAndUpdateUnit()">Thêm mới</button>
  </ng-template>
</p-dialog>

<p-dialog [(visible)]="chooseUnitParentDialog" [style]="{width: '550px'}"
          header="Chọn Đơn vị lớn nhất để đứng đầu nhánh đơn vị" [modal]="true" styleClass="p-fluid">
  <ng-template pTemplate="content">
    <div class="field-radiobutton" *ngFor="let item of unitDeleteEdit, let i = index">
      <p-radioButton name="city" value="{{item.id}}" [(ngModel)]="unitIdChooseParent"
                     inputId="item{{i}}"></p-radioButton>
      <label>{{item.unitName}}</label>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <button pButton pRipple label="Hủy" icon="pi pi-times" class="p-button-text"
            (click)="hideChooseUnitParentDialog()"></button>
    <button pButton pRipple label="Tiếp theo" icon="pi pi-check" class="p-button-text"
            (click)="openEditAmountUnit()"></button>
  </ng-template>
</p-dialog>

<p-dialog [(visible)]="editUnitParentDialog" [style]="{width: '550px'}" header="Hãy sửa lại số lượng của đơn vị"
          [modal]="true" styleClass="p-fluid">
  <ng-template pTemplate="content">
    <h5 class="text-danger">*Đơn vị sẽ từ cao tới thấp, nên hãy nhập số lượng tăng dần qua các đơn vị</h5>
    <div class="field-radiobutton row" *ngFor="let item of cloneUnitDeleteEdit, let i = index">
      <span class="col-4 align-content-between"><label>{{item.unitName}}</label></span>
      <span class="col-8">
          <p-inputNumber mode="decimal" [(ngModel)]="item.amount" [min]="1"></p-inputNumber>
          <small class="p-invalid text-danger" *ngIf="submitEditUnitParentDialog && !item.amount">{{item.unitName}} is required.</small>
        </span>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <button pButton pRipple label="Quay lại" icon="pi pi-times" class="p-button-text"
            (click)="prevChooseUnitParentDialog()"></button>
    <button pButton pRipple label="Hoàn thành" icon="pi pi-check" class="p-button-text"
            (click)="confirmDeleteParentUnit()"></button>
  </ng-template>
</p-dialog>
